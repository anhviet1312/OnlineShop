@model ShopOnline.Models.ViewModels.ViewProductModel

@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    .ellipsis {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    #editModal .modal-dialog {
        max-width: 1200px;
    }

    #editModal .form-input {
        width: 300px;
        margin-left: 50px;
    }
</style>
<h1>Index</h1>

<p>
    <a asp-action="Create">Create New</a>
</p>
<table class="table table-striped table-hover" style="table-layout: fixed">
    <thead>
        <tr>
            <th class="ellipsis">
                @Html.DisplayNameFor(model => model.Products[0].Name)
            </th>
            <th class="ellipsis">
                @Html.DisplayNameFor(model => model.Products[0].Alias)
            </th>
            <th class="ellipsis">
                @Html.DisplayNameFor(model => model.Products[0].Image)
            </th>
            <th class="ellipsis">
                @Html.DisplayNameFor(model => model.Products[0].MoreImages)
            </th>
            <th class="ellipsis">
                @Html.DisplayNameFor(model => model.Products[0].Price)
            </th>
            <th class="ellipsis">
                @Html.DisplayNameFor(model => model.Products[0].OriginalPrice)
            </th>
            <th class="ellipsis">
                @Html.DisplayNameFor(model => model.Products[0].PromotionPrice)
            </th>
            <th class="ellipsis">
                @Html.DisplayNameFor(model => model.Products[0].Description)
            </th>
            <th class="ellipsis">
                @Html.DisplayNameFor(model => model.Products[0].Content)
            </th>
            <th class="ellipsis">
                @Html.DisplayNameFor(model => model.Products[0].HomeFlag)
            </th>
            <th class="ellipsis">
                @Html.DisplayNameFor(model => model.Products[0].HotFlag)
            </th>
            <th class="ellipsis">
                @Html.DisplayNameFor(model => model.Products[0].ViewCount)
            </th>
            <th class="ellipsis">
                @Html.DisplayNameFor(model => model.Products[0].Tags)
            </th>
            <th class="ellipsis">
                @Html.DisplayNameFor(model => model.Products[0].Quantity)
            </th>
            <th class="ellipsis">
                @Html.DisplayNameFor(model => model.Products[0].ProductCategory)
            </th>
            <th class="ellipsis">
                @Html.DisplayNameFor(model => model.Products[0].CreatedDate)
            </th>
            <th class="ellipsis">
                @Html.DisplayNameFor(model => model.Products[0].CreatedBy)
            </th>
            <th class="ellipsis">
                @Html.DisplayNameFor(model => model.Products[0].UpdatedDate)
            </th>
            <th class="ellipsis">
                @Html.DisplayNameFor(model => model.Products[0].UpdatedBy)
            </th>
            <th class="ellipsis"></th>
            <th class="ellipsis"></th>
        </tr>
    </thead>
    <tbody>
@foreach (var item in Model.Products) {
        <tr>
            <td class="ellipsis">
                @Html.DisplayFor(modelItem => item.Name)
            </td>
            <td class="ellipsis">
                @Html.DisplayFor(modelItem => item.Alias)
            </td>
            <td class="ellipsis">
                @Html.DisplayFor(modelItem => item.Image)
            </td>
            <td class="ellipsis">
                @Html.DisplayFor(modelItem => item.MoreImages)
            </td>
            <td class="ellipsis">
                @Html.DisplayFor(modelItem => item.Price)
            </td>
            <td class="ellipsis">
                @Html.DisplayFor(modelItem => item.OriginalPrice)
            </td>
            <td class="ellipsis">
                @Html.DisplayFor(modelItem => item.PromotionPrice)
            </td>
            <td class="ellipsis">
                @Html.DisplayFor(modelItem => item.Description)
            </td>
            <td class="ellipsis">
                @Html.DisplayFor(modelItem => item.Content)
            </td>
            <td class="ellipsis">
                @Html.DisplayFor(modelItem => item.HomeFlag)
            </td>
            <td class="ellipsis">
                @Html.DisplayFor(modelItem => item.HotFlag)
            </td>
            <td class="ellipsis">
                @Html.DisplayFor(modelItem => item.ViewCount)
            </td>
            <td class="ellipsis">
                @Html.DisplayFor(modelItem => item.Tags)
            </td>
            <td class="ellipsis">
                @Html.DisplayFor(modelItem => item.Quantity)
            </td>
            <td class="ellipsis">
                @Html.DisplayFor(modelItem => item.ProductCategory.Alias)
            </td>
            <td class="ellipsis">
                @Html.DisplayFor(modelItem => item.CreatedDate)
            </td>
            <td class="ellipsis">
                @Html.DisplayFor(modelItem => item.CreatedBy)
            </td>
            <td class="ellipsis">
                @Html.DisplayFor(modelItem => item.UpdatedDate)
            </td>
            <td class="ellipsis">
                @Html.DisplayFor(modelItem => item.UpdatedBy)
            </td>
            <td>
                        <button onclick="Edit(@item.ID)" class="btn btn-primary">Edit</button>
                                        
            </td>
            <td>
                    <button onclick="Delete(@item.ID)" class="btn btn-primary">Delete</button>
            </td>
        </tr>
}
    </tbody>
</table>

<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editModalLabel">Edit Product</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editForm" asp-action="Edit" method="post">
                <div class="modal-body">

                    <div asp-validation-summary="All" class="text-danger"></div>
                    <div class="d-flex w-100">
                        <div class="form-group form-input">
                            <label asp-for="CreateOrUpdate.Name"></label>
                            <input id="update_Name" asp-for="CreateOrUpdate.Name" class="form-control" />
                            <span asp-validation-for="CreateOrUpdate.Name" class="text-danger"></span>
                        </div>

                        <div class="form-group form-input">
                            <label asp-for="CreateOrUpdate.Alias"></label>
                            <input id="update_Alias" asp-for="CreateOrUpdate.Alias" class="form-control" />
                            <span asp-validation-for="CreateOrUpdate.Alias" class="text-danger"></span>
                        </div>

                        <div class="form-group form-input">
                            <label asp-for="CreateOrUpdate.CategoryID" class="control-label"></label>
                            <select id="update_CategoryID" asp-for="CreateOrUpdate.CategoryID" class="form-control" asp-items="@(new SelectList(Model.CreateOrUpdate.ListCategories, "ID", "Name"))"></select>
                        </div>
                    </div>

                    <div class="d-flex w-100">
                        <div class="form-group form-input">
                            <label asp-for="CreateOrUpdate.Image" class="control-label"></label>
                            <input id="update_Image" asp-for="CreateOrUpdate.Image" class="form-control" />
                            <span asp-validation-for="CreateOrUpdate.Image" class="text-danger"></span>
                        </div>
                        <div class="form-group form-input">
                            <label asp-for="CreateOrUpdate.MoreImages" class="control-label"></label>
                            <input id="update_MoreImages" asp-for="CreateOrUpdate.MoreImages" class="form-control" />
                            <span asp-validation-for="CreateOrUpdate.MoreImages" class="text-danger"></span>
                        </div>
                        <div class="form-group form-input">
                            <label asp-for="CreateOrUpdate.Price" class="control-label"></label>
                            <input id="update_Price" asp-for="CreateOrUpdate.Price" class="form-control" />
                            <span asp-validation-for="CreateOrUpdate.Price" class="text-danger"></span>
                        </div>


                    </div>
                    <div class="d-flex w-100">
                        <div class="form-group form-input">
                            <label asp-for="CreateOrUpdate.OriginalPrice" class="control-label"></label>
                            <input id="update_OriginalPrice" asp-for="CreateOrUpdate.OriginalPrice" class="form-control" />
                            <span asp-validation-for="CreateOrUpdate.OriginalPrice" class="text-danger"></span>
                        </div>
                        <div class="form-group form-input">
                            <label asp-for="CreateOrUpdate.PromotionPrice" class="control-label"></label>
                            <input id="update_PromotionPrice" asp-for="CreateOrUpdate.PromotionPrice" class="form-control" />
                            <span asp-validation-for="CreateOrUpdate.PromotionPrice" class="text-danger"></span>
                        </div>
                        <div class="form-group form-input">
                            <label asp-for="CreateOrUpdate.Description" class="control-label"></label>
                            <input id="update_Description" asp-for="CreateOrUpdate.Description" class="form-control" />
                            <span asp-validation-for="CreateOrUpdate.Description" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="d-flex w-100">
                        <div class="form-group form-input">
                            <label asp-for="CreateOrUpdate.Content" class="control-label"></label>
                            <input id="update_Content" asp-for="CreateOrUpdate.Content" class="form-control" />
                            <span asp-validation-for="CreateOrUpdate.Content" class="text-danger"></span>
                        </div>
                        <div class="form-group form-input">
                            <label asp-for="CreateOrUpdate.HomeFlag" class="control-label"></label>
                            <input id="update_HomeFlag" asp-for="CreateOrUpdate.HomeFlag" class="form-control" />
                            <span asp-validation-for="CreateOrUpdate.HomeFlag" class="text-danger"></span>
                        </div>
                        <div class="form-group form-input">
                            <label asp-for="CreateOrUpdate.HotFlag" class="control-label"></label>
                            <input id="update_HotFlag" asp-for="CreateOrUpdate.HotFlag" class="form-control" />
                            <span asp-validation-for="CreateOrUpdate.HotFlag" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="d-flex w-100">
                        <div class="form-group form-input">
                            <label asp-for="CreateOrUpdate.ViewCount" class="control-label"></label>
                            <input id="update_ViewCount" asp-for="CreateOrUpdate.ViewCount" class="form-control" />
                            <span asp-validation-for="CreateOrUpdate.ViewCount" class="text-danger"></span>
                        </div>
                        
                        <div class="form-group form-input">
                            <label asp-for="CreateOrUpdate.ListSelectedTags" class="control-label">Tags</label>
                            <select id="update_ListSelectedTags" asp-for="CreateOrUpdate.ListSelectedTags" class="form-control" asp-items="@(new SelectList(Model.CreateOrUpdate.ListTags, "ID", "Name"))" multiple></select>
                            <span asp-validation-for="CreateOrUpdate.ListSelectedTags" class="text-danger"></span>
                        </div>


                        <div class="form-group form-input">
                            <label asp-for="CreateOrUpdate.Quantity" class="control-label"></label>
                            <input id="update_Quantity" asp-for="CreateOrUpdate.Quantity" class="form-control" />
                            <span asp-validation-for="CreateOrUpdate.Quantity" class="text-danger"></span>
                        </div>
                    </div>
                    <input type="hidden" id="productId" name="productId" />
                    <!-- Include other form fields for editing -->

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editModalLabel">Delete Product Category</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="deleteForm" asp-action="Delete" method="post">
                <div class="modal-body">
                    Are you sure to delete this product ?

                  </div>  
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Confirm</button>
                </div>
                <input id="deleteId" type="hidden" name="id"/>
            </form>
        </div>
    </div>
</div>
@section Scripts{
    <script>
        $(document).ready(function () {

        });


        var Edit = function (id) {
            $.ajax({
                url: '@Url.Action("Edit", "Product")/' + id,
                type: 'GET'
            })
                .done(function (response) {
                    // Populate the modal form fields with the values from the JSON response
                    console.log(response)
                    $('#update_Name').val(response.name);                    
                    $('#update_Alias').val(response.alias);
                    $('#update_CategoryID').val(response.categoryID);

                    $('#update_Image').val(response.image);
                    $('#update_MoreImages').val(response.moreImages);
                    $('#update_Price').val(response.price);

                    $('#update_PromotionPrice').val(response.promotionPrice);
                    $('#update_Description').val(response.description);
                    $('#update_OriginalPrice').val(response.originalPrice);

                    $('#update_Content').val(response.content);
                    $('#update_HomeFlag').val(response.homeFlag);
                    $('#update_HotFlag').val(response.hotFlag);

                    $('#update_ViewCount').val(response.viewCount);
                    $('#update_ListSelectedTags').val(response.listSelectedTags);
                    $('#update_Quantity').val(response.quantity);


                    $('#productId').val(response.id);

                    $('#editModal').modal('show');
                })
                .fail(function (xhr, status, error) {
                    console.log(error);
                });
        }

        var Delete = function (id){
            $('#deleteModal').modal('show');
            $('#deleteId').val(id);
        }

    </script>

}

